# Cargo Configuration for Cream
# See: docs/plans/14-testing.md lines 849-873
#
# Usage:
#   cargo cov       - Generate lcov.info for CI (Codecov)
#   cargo cov-html  - Generate HTML report for local viewing
#   cargo cov-check - Verify coverage meets 80% threshold
#
# Prerequisites:
#   rustup component add llvm-tools-preview
#   cargo install cargo-llvm-cov

# ============================================
# Command Aliases
# ============================================
[alias]
# Generate LCOV format coverage for CI integration
cov = "llvm-cov --workspace --lcov --output-path lcov.info"

# Generate HTML report for local development
cov-html = "llvm-cov --workspace --html --output-dir coverage"

# Run coverage with line threshold check (80% for execution-engine)
cov-check = "llvm-cov --workspace --fail-under-lines 80"

# Generate both LCOV and HTML
cov-all = "llvm-cov --workspace --lcov --output-path lcov.info --html --output-dir coverage"

# Clean coverage artifacts
cov-clean = "llvm-cov clean --workspace"

# ============================================
# Build Configuration
# ============================================
[build]
# Use lld linker if available (faster linking)
# Uncomment if lld is installed:
# rustflags = ["-C", "link-arg=-fuse-ld=lld"]

# ============================================
# Target-Specific Configuration
# ============================================
[target.x86_64-unknown-linux-gnu]
# Linux-specific settings (CI environment)

[target.x86_64-apple-darwin]
# Intel Mac settings

[target.aarch64-apple-darwin]
# Apple Silicon Mac settings

# ============================================
# Environment Variables
# ============================================
[env]
# LLVM profile file pattern for coverage
# %p = process ID, %m = unique hash
LLVM_PROFILE_FILE = { value = "coverage-%p-%m.profraw", force = false }
