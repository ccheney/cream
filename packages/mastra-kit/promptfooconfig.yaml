# Promptfoo Configuration
# See: docs/plans/14-testing.md lines 295, 399-424
#
# Declarative test configuration for agent evaluations.
# Run: npx promptfoo eval
#
# API Keys required:
#   - GOOGLE_API_KEY: For Gemini provider

# ============================================
# Description
# ============================================
description: "Cream Trading System - Agent Evaluations"

# ============================================
# Providers
# ============================================
providers:
  - id: gemini:gemini-3-pro-preview
    label: Gemini 3 Pro
    config:
      temperature: 0.1
      maxOutputTokens: 4096

  - id: gemini:gemini-3-flash-preview
    label: Gemini 3 Flash
    config:
      temperature: 0.1
      maxOutputTokens: 2048

# ============================================
# Default Test Settings
# ============================================
defaultTest:
  options:
    provider: gemini:gemini-3-pro-preview
    timeout: 60000

# ============================================
# Prompts (Agent Prompts)
# ============================================
prompts:
  - label: Technical Analyst
    raw: |
      You are a Technical Analyst for an algorithmic trading system.
      Analyze the following market snapshot and provide technical analysis.

      {{snapshot}}

      Provide your analysis including:
      1. Trend direction (bullish/bearish/neutral)
      2. Key support/resistance levels
      3. Momentum indicators assessment
      4. Entry/exit recommendations

  - label: Trader Agent
    raw: |
      You are a Trader Agent for an algorithmic trading system.
      Based on the analysis provided, generate a trading decision.

      {{analysis}}

      Provide a DecisionPlan with:
      1. Action (BUY/SELL/HOLD)
      2. Position size
      3. Entry price
      4. Stop loss
      5. Take profit
      6. Rationale

# ============================================
# Test Suites
# ============================================
tests:
  # Technical Analyst Tests
  - description: "TA: Bullish trend detection"
    vars:
      snapshot: |
        AAPL: Price $185.50, SMA20 $180, SMA50 $175
        RSI: 65, MACD: Bullish crossover
        Volume: Above average
    assert:
      - type: contains
        value: "bullish"
      - type: llm-rubric
        value: "The analysis correctly identifies bullish momentum"

  - description: "TA: Bearish trend detection"
    vars:
      snapshot: |
        MSFT: Price $350, SMA20 $360, SMA50 $370
        RSI: 35, MACD: Bearish crossover
        Volume: Below average
    assert:
      - type: contains
        value: "bearish"
      - type: llm-rubric
        value: "The analysis correctly identifies bearish momentum"

  # Semantic Similarity Tests
  - description: "Semantic: Rationale captures key factors"
    vars:
      analysis: |
        Technical analysis shows strong bullish momentum.
        Price above all moving averages.
        RSI at 65 indicates room for upside.
    assert:
      - type: similar
        value: "Bullish momentum with trend continuation signals"
        threshold: 0.8
        provider: gemini:gemini-embedding-001

  # Decision Validation Tests
  - description: "Decision: Valid BUY decision structure"
    vars:
      analysis: |
        Strong bullish setup. Recommend BUY.
        Entry: $185, Stop: $180, Target: $195
    assert:
      - type: contains
        value: "BUY"
      - type: javascript
        value: |
          output.includes('stop') && output.includes('target')

# ============================================
# Output Configuration
# ============================================
outputPath: eval-results.json

# ============================================
# Sharing (Optional)
# ============================================
# sharing:
#   apiKey: ${PROMPTFOO_API_KEY}
#   appUrl: https://www.promptfoo.dev
