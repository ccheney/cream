# Buf code generation configuration
# https://buf.build/docs/configuration/v2/buf-gen-yaml
version: v2

# Clean output directories before generation
clean: true

# Managed mode for consistent options across languages
managed:
  enabled: true
  override:
    - file_option: go_package_prefix
      value: github.com/cream-trading/cream/gen/go

inputs:
  - directory: .

plugins:
  # TypeScript (ES modules) - Protobuf-ES v2.x for message types and service descriptors
  # Note: Connect v2 no longer needs a separate plugin - service descriptors are in _pb files
  - remote: buf.build/bufbuild/es:v2.2.3
    out: ../schema-gen/ts
    include_imports: true
    opt:
      - target=ts
      - import_extension=js

  # Python - Uses protoc built-in Python plugin via BSR
  - remote: buf.build/protocolbuffers/python
    out: ../schema-gen/python

  # Python type stubs
  - remote: buf.build/protocolbuffers/pyi
    out: ../schema-gen/python

  # Rust - Prost for message types
  # Note: Not compiling well-known types - we use prost-types crate instead
  - remote: buf.build/community/neoeinstein-prost
    out: ../schema-gen/rust

  # Rust - Tonic for gRPC service stubs
  - remote: buf.build/community/neoeinstein-tonic
    out: ../schema-gen/rust
