# Bun configuration for Cream monorepo
# See: https://bun.sh/docs/runtime/bunfig
#
# Coverage Tier Reference (docs/plans/14-testing.md lines 809-817):
# - Critical (execution-engine, broker, domain): 90/85/90
# - Core (indicators, helix, schema): 80/75/80
# - Standard (api, research, test-fixtures): 70/65/70 (root default)
# - Agent (mastra-kit): 60/50/60

[install]
# Link workspace packages from monorepo root
linkWorkspacePackages = true

# Use exact versions for deterministic builds
exact = true

# Production dependencies only in production
production = false

[test]
# Enable coverage by default
coverage = true
coverageDir = "coverage"

# Standard tier coverage thresholds (70/65/70)
coverageThreshold = { line = 70, branch = 65, function = 70 }

# Coverage reporters
# - text: Console output during test run
# - lcov: For Codecov integration
coverageReporter = ["text", "lcov"]

# Exclude Playwright visual regression tests (run separately via playwright test)
# Note: *.spec.ts files in visual/ and e2e/ directories use Playwright, not bun:test
# Also exclude dashboard React component tests (require Next.js JSX runtime, run via dashboard package)
exclude = ["**/tests/visual/**", "**/tests/e2e/**", "**/visual/*.spec.ts", "**/e2e/*.spec.ts", "**/dashboard/**/*.test.tsx", "**/dashboard/**/*.test.ts"]

# Patterns to exclude from coverage
coverageIgnorePatterns = [
  "**/*.test.ts",
  "**/*.spec.ts",
  "**/test-fixtures/**",
  "**/mocks/**",
  "**/*.d.ts",
  "**/node_modules/**",
  "**/dist/**",
]

# Timeout for individual tests (ms)
timeout = 30000

[run]
# Silence bun lifecycle scripts by default
silent = false
